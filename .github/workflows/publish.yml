name: Publish
on:
  release:
    types: [published]

jobs:
  publish-on-pypi-servers:
    env:
      TWINE_PASSWORD: ${{ secrets.TWINE_PASSWORD }}
      TWINE_REPOSITORY_URL: ${{ secrets.TWINE_REPOSITORY_URL }}
      TWINE_USERNAME: ${{ secrets.TWINE_USERNAME }}
      TWINE_NON_INTERACTIVE: "1"
    runs-on: ubuntu-20.04
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-python@v3
      with:
        python-version: 3.7
    - name: Prepare
      run: |
        pip install --upgrade pip
        pip install --upgrade setuptools wheel twine
    - name: Build substrafl
      run: |
        python setup.py sdist bdist_wheel
    - name: Publish substrafl on pypi.owkin.com
      run: |
        twine upload dist/* --verbose
